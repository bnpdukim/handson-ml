##CHAPTER 2 머신러닝 프로젝트 처음부터 끝까지
* 처음부터 끝까지 진행하기 위한 주요 단계
  1. 큰 그림을 봅니다.
  2. 데이터를 구합니다
  3. 데이터로부터 통찰을 얻기 위해 탐색하고 시각화합니다.
  4. 머신러닝 알고리즘을 위해 데이터르를 준비합니다.
  5. 모델을 선택하고 훈련시킵니다.
  6. 모델을 상세하게 조정합니다.
  7. 솔루션을 제시합니다.
  8. 시스템을 론칭하고 모니터링하고 유지 보수합니다.

###2.1 실제 데이터로 작업하기
* 데이터 획득
  - 유명한 공개 데이터 저장소
    - UC 얼바인 머신러닝 저장소(http://archive.ics.uci.edu/ml/)
    - 캐글 데이터셋(http://www.kaggle.com/datasets)
    - 아마존 AWS 데이터셋(http://aws.amazon.com/ko/datasets)
  - 메타 포털
    - https://dataportals.org
    - https://opendatamonitor.eu
    - https://quandl.com
  - 저장소가 나열되어 있는 다른 페이지
    - 위키백과 머신러닝 데이터셋 목록(https://goo.gl/SJHN2k)
    - Quora.com질문(https://goo.gl/zDR78y)
    - 데이터셋 서브레딧(https://www.reddit.com/r/datasets)
* 캘리포니아 주택 가격으로 실습 진행
  - http://lib.stat.cmu.edu/datasets
  - 1990년 캘리포니아 인구조사 데이터 기

###2.2 큰 그림 보기반
* 해야 할 일
  - 캘리포니아 인구조사 데이터를 사용해 캘리포니아의 주택 가격 모델을 만드는 것
    - 데이터는 블록 그룹마다 population(인구), median income(중간 소득), median housing price(중간 주택 가격) 으로 구성
      - 블록 그룹은 최소한의 지리적 단위
  - 모델을 학습시켜서 다른 데이터가 주어졌을때 해당 구역의 주택가격을 예측해야함

####2.2.1 문제정의
* 비지니스의 목적 고찰
  - 모델 만드는 것이 목적이 아님
  - 모델을 사용해 어떻게 수익을 낼지에 대한 고민 필요
    - 문제를 어떻게 구성할지
    - 어떤 알고리즘을 선택할지
    - 모델 평가에 어떤 성능 지표를 사용할지
    - 모델 튜닝을 위해 얼마나 노력을 투여할지 결정
  - 예) 그림 2-2
    - 여러 가지 다른 신호와 함께 다른 머신러닝 시스템에 입력으로 사용
* 현재 솔루션의 구성 현황
  - 문제 해결 방법에 대한 정보 및 참고 성능으로 활용 가능
  - 예) 주택가격을 전문가가 수동으로 추정
    - 복잡한 규칙을 사용하여 추정
    - 10%이상 벗어남
  - 문제 정의
    - 지도학습, 비지도학습, 강화학습?
    - 분류, 회귀, etc?
    - 배치 학습, 온라인 학습?

####2.2.2 성능 측정 지표 선택
* 회귀 문제의 성능지표 : 평균 제곱근 오차(Root Mean Square Error:RMSE)
  - 식 2-1
    - 표기법 반드시 리뷰
  - 노름(norm)
    - 노름의 지수가 클수록 큰 값의 원소에 치우치며 작은 값 무시
    - RMSE(l2 norm)가 MAE(l1 norm)보다 조금 더 이상치에 민감함
####2.2.3 가정 검사
* 지금까지 만든 가정을 나열하고 검사해보는 것이 좋음
* 예) 하위 시스템에서 입력으로 들어가게 되는데 이 값을 그대로 사용할 거라 가정
  - 만일 하위 시스템이 ('저렴', '보통', '고가')의 카테고리로 바꾼다면
    - 회귀 -> 분류 문제로 바뀜
###2.3 데이터 가져오기
####2.3.1 작업환경 만들기
* 주요 패키지
  - 주피터, 넘파이, 판다스, 맷플롯립, 사이킷런
* 독립적인 환경 만들기
  - virtualenv(맥,리눅스), conda, docker etc..
####2.3.2 데이터 다운로드
* 데이터 다운로드 및 추출 함수 작성
####2.3.3 데이터 구조 훑어보기
* housing.head()
  - 총 10개의 특성
    - longuitude, latitude, housing_median_age, total_rooms, total_bedrooms, 
    population, households, median_incom, median_house_value, ocean_proximity
* housing.info()
  - 20,640개의 샘플
  - total_bedrooms 특성은 20,433개의 구역만 값이 있으며 207개 구역은 특성을 가지지 않음
    - 적절히 데이터 전처리 해줘야함
  - ocean_proximity는 텍스트 특성
    - 범주형
    - housing["ocean_proximity"].value.counts() 를 통해 카테고리에 있는 구역수 조회 가능
* housing.describe()
  - 숫자형 특성의 요약 정보를 보여줌
* housing.hist()
  - 히스토그램 출력
  1 median_income은 스케일 조정으로 0.5~15의 범위를 가짐
    - 데이터가 어떻게 계산된 것인지 이해하고 있어야 함
  2 housing_median_age, median_house_value는 최대값과 최소값을 한정
    - median_house_value는 레이블로 사용되기 때문에 심각한 문제 발생 가능
      a. 정확한 레이블 값을 구함
      b. 훈련 세트와 테스트 세트에서 해당 구역을 제거(50000$)
  3 특성들의 스케일이 많이 다름
  4 히스토그램의 꼬리가 두꺼움
    - 종 모양이 되도록 변형 필요
####2.3.4 테스트 세트 만들기
* 데이터 스누핑 편향
  - 테스트 세트를 보고 머신러닝 모델을 선택할시 일반화 오차는 적겠지만 실제 운영에서 성능 낮음
* 시도 1 : 20%의 데이터를 랜덤하게 선택
  - 프로그램 재 실행시 다른 테스트 세트가 생성
  - 여러번 시행하면 결국 데이터 스누핑 편향과 비슷해짐
* 시도 2 : 처음 실행에서 테스트 세트를 저장하고 다음번 실행에서 이를 불러옴
* 시도 3 : 항상 같은 난수 인덱스가 생성되도록 seed 지정
* 시도 2,3 모두 데이터셋이 업데이트 되면 문제 발생함
* 시도 4 : 샘플의 식별자를 사용하여 테스트 세트로 보낼지 말지 결정
  - 각 샘플마다 식별자의 해시값을 계산하여 해시의 마지막 바이트 값이 51(256의 20%)보다 작은 샘플만 테스트 데이터로 사용
  - 주택 데이터셋에는 식별자 컬럼이 없지만 행의 인덱스를 ID로 사용하면 간단히 해결
    - 새로운 데이터 추가시 데이터셋의 끝에 추가되어야 하며 행도 삭제되면 안됨
  - 경도와 위도의 조합은 좋은 식별자가 될 수 있음
* 시도 5 : 사이킷런의 train_test_split 이용
* 시도 1-5까지는 무작위 샘플링 방식
  - 데이터의 크기가 충분히 크지 않다면 샘플링 편향이 생길수 있음
* 계층적 샘플링(stratified sampling)
  - 인구 비율이 여성이 51.3%이고 남성이 48.7% 이라면 
    1000명을 뽑았을시 여성 513명, 남성 487명 이어야 함
  - 무작위 샘플링에서는 49%작거나 54%보다 많은 여성이 뽑힐 확률이 12%임.
* 중간 소득이 중간 주택 가격을 예측하는데 매우 중요하다고 가정할 시
  - 테스트 세트가 전체 데이터셋에 있는 소득 카테고리를 잘 대표해야함
  - 중간 소득은 숫자형이므로 카테고리로 만드는 작업 해야함
    - 계층별로 충분한 샘플수가 있어야 하므로 너무 많은 계층으로 나누면 안됨
* 계층적 샘플링은 사이킷런의 StratifiedShuffleSplit 이용
* 테스트 세트 생성은 머신러닝에서 아주 중요함
  - 교차 검증할때도 도움됨
###2.4 데이터 이해를 위한 탐색과 시각화
####2.4.1 지리적 데이터 시각화
####2.4.2 상관관계 조사
####2.4.3 특성 조합으로 실험
###2.5 머신러닝 알고리즘을 위한 데이터 준비
####2.5.1 데이터 정제
####2.5.2 텍스트와 범주형 특성 다루기
####2.5.3 나만의 변환기
####2.5.4 특성 스케일링
####2.5.5 변환 파이프라인
###2.6 모델 선택과 훈련
####2.6.1 훈련 세트에서 훈련하고 평가하기
####2.6.2 교차 검증을 사용한 평가
###2.7 모델 세부 튜닝
####2.7.1 그리드 탐색
####2.7.2 랜덤 탐색
####2.7.3 앙상블 방법
####2.7.4 최상의 모델과 오차 분석
####2.7.5 테스트 세트로 시스템 평가하기
###2.8 론칭,모니터링,시스템 유지 보수
###2.9 직접 해보세요!
###2.10 연습문제